import{j as e}from"./charts-8gUIbWxc.js";import{b as c}from"./vendor-125d4HLq.js";import{b,u as Z}from"./index-Ca2M97Gg.js";const _=2*1024*1024,J=["video/mp4","video/avi","video/quicktime","video/x-msvideo","video/x-ms-wmv","video/webm"];function ae({lessonId:a,onUploadSuccess:l,existingVideo:x,mode:T="lesson",title:W,description:B,allowMultiple:m=!1}){const d=T==="lesson",p=d?`/lessons/${a}/video/chunked`:"/media-library/videos/chunked",E=d?`/lessons/${a}/video`:null,L=W||(d?"الفيديو":"رفع فيديو إلى مكتبة الوسائط"),S=B||(m&&!d?"يمكن اختيار عدة ملفات (MP4, AVI, MOV, WMV, WebM) وسيتم رفعها بالتتابع عبر الرفع المجزأ":"MP4, AVI, MOV, WMV, WebM (أي حجم - سيتم تقسيم الملفات الكبيرة تلقائياً)"),[w,$]=c.useState(!1),[R,v]=c.useState(0),[z,u]=c.useState(null),[V,k]=c.useState(!1),[i,h]=c.useState(null),[j,C]=c.useState(0),A=c.useRef(null),y=c.useRef(null),g=c.useRef([]),M=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?k(!0):s.type==="dragleave"&&k(!1)},O=s=>{s.preventDefault(),s.stopPropagation(),k(!1),s.dataTransfer.files&&s.dataTransfer.files.length&&I(s.dataTransfer.files)},q=s=>{s.preventDefault(),s.target.files&&s.target.files.length&&I(s.target.files)},I=s=>{const n=Array.from(s||[]);if(!n.length)return;const r=[];let t=!1;if(n.forEach(o=>{J.includes(o.type)?r.push(o):t=!0}),t&&u("نوع الفيديو غير مدعوم. الأنواع المدعومة: MP4, AVI, MOV, WMV, WebM"),!!r.length){if(d||!m){P(r[0]);return}g.current=[...g.current,...r],C(g.current.length),!i&&!w&&F()}};async function P(s){var n,r;if(s){u(null),$(!0),v(0);try{const t=Math.ceil(s.size/_),o=await b.post(`${p}/start`,{file_name:s.name,file_size:s.size,total_chunks:t,file_type:s.type});if(!o.data.success)throw new Error(o.data.message);const f=o.data.upload_id;h({uploadId:f,file:s,totalChunks:t,uploadedChunks:0}),await K(f,s,t);const N=await b.post(`${p}/${f}/complete`);N.data.success&&(l&&await l(N.data.data),v(100),h(null))}catch(t){h(null),t.message!=="Upload paused"&&u(((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.message)||t.message||"فشل رفع الفيديو")}finally{$(!1),!d&&m&&g.current.length>0&&F()}}}function F(){if(!g.current.length)return;const s=g.current.shift();C(g.current.length),P(s)}const K=async(s,n,r)=>{for(let t=0;t<r;t++){const o=t*_,f=Math.min(o+_,n.size),N=n.slice(o,f),D=new FormData;D.append("chunk",N),D.append("chunk_index",t),y.current=new AbortController,await b.post(`${p}/${s}/chunk`,D,{headers:{"Content-Type":"multipart/form-data"},signal:y.current.signal});const U=Math.round((t+1)/r*100);v(U),h(Y=>({...Y,uploadedChunks:t+1}))}},Q=async()=>{if(i){y.current&&y.current.abort();try{await b.delete(`${p}/${i.uploadId}`)}catch(s){console.error("Failed to cancel upload:",s)}h(null),$(!1),v(0),u(null),!d&&m&&(g.current=[],C(0))}},G=async()=>{var s,n;if(confirm("هل أنت متأكد من حذف الفيديو؟"))try{if(!E)return;(await b.delete(E)).data.success&&(l==null||l(null))}catch(r){u(((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message)||"فشل حذف الفيديو")}},H=s=>{if(s===0)return"0 Bytes";const n=1024,r=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(s)/Math.log(n));return Math.round(s/Math.pow(n,t)*100)/100+" "+r[t]};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:L}),d&&x?e.jsx("div",{className:"border-2 border-slate-200 rounded-xl p-4 bg-gradient-to-br from-slate-50 to-blue-50/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-video text-white text-xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:x.file_name}),e.jsxs("p",{className:"text-sm text-slate-600 flex items-center gap-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-database text-xs"}),x.formatted_size]}),x.formatted_duration&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-clock text-xs"}),x.formatted_duration]})]})]})]}),e.jsxs("button",{onClick:G,className:"px-4 py-2 text-sm border-2 border-red-200 text-red-600 rounded-lg hover:bg-red-50 font-bold transition-all",children:[e.jsx("i",{className:"fas fa-trash ml-1"}),"حذف"]})]})}):e.jsxs("div",{className:`border-2 border-dashed rounded-xl p-12 text-center transition-all ${V?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-blue-50 scale-105 shadow-lg":"border-slate-300 hover:border-indigo-300 hover:bg-slate-50"}`,onDragEnter:M,onDragLeave:M,onDragOver:M,onDrop:O,children:[e.jsx("input",{ref:A,type:"file",className:"hidden",accept:"video/mp4,video/avi,video/quicktime,video/x-msvideo,video/x-ms-wmv,video/webm",multiple:!d&&m,onChange:q,disabled:w}),w?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-indigo-100 to-blue-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-indigo-600 text-3xl"})}),e.jsx("p",{className:"text-slate-900 font-bold text-lg",children:"جاري رفع الفيديو..."}),i&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 border-2 border-slate-200",children:[e.jsx("p",{className:"text-sm font-bold text-slate-900 mb-1",children:i.file.name}),e.jsx("p",{className:"text-xs text-slate-600",children:H(i.file.size)})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 h-3 rounded-full transition-all duration-300",style:{width:`${R}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("p",{className:"text-2xl font-black text-slate-900",children:[R,"%"]}),i&&e.jsxs("p",{className:"text-sm text-slate-600 bg-slate-100 px-3 py-1 rounded-full",children:["الجزء ",i.uploadedChunks," /"," ",i.totalChunks]})]}),e.jsx("div",{className:"flex gap-3 justify-center mt-6",children:e.jsxs("button",{onClick:Q,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:shadow-lg transition-all font-bold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-times"}),e.jsx("span",{children:"إلغاء"})]})}),!d&&m&&j>0&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-3 text-blue-700 text-sm font-semibold",children:[e.jsx("i",{className:"fas fa-clock ml-1"}),"سيتم رفع ",j," ملف/ملفات بعد اكتمال الملف الحالي"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-indigo-100 to-blue-100 flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-cloud-upload-alt text-indigo-600 text-4xl"})}),e.jsx("p",{className:"text-lg font-bold text-slate-900 mb-2",children:"اسحب الفيديو هنا أو اختر من جهازك"}),e.jsxs("button",{type:"button",className:"mt-4 px-8 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-xl hover:shadow-xl transition-all font-bold text-lg",onClick:()=>{var s;return(s=A.current)==null?void 0:s.click()},children:[e.jsx("i",{className:"fas fa-folder-open ml-2"}),"اختر ملف فيديو"]}),e.jsx("p",{className:"mt-4 text-sm text-slate-600 bg-slate-50 rounded-lg px-4 py-2 inline-block",children:S}),!d&&m&&j>0&&e.jsxs("div",{className:"mt-4 bg-blue-50 border-2 border-blue-200 rounded-lg p-3 text-blue-700 text-sm font-semibold inline-block",children:[e.jsx("i",{className:"fas fa-list ml-1"}),"في الانتظار: ",j," ملف/ملفات سيتم رفعها تلقائياً"]})]})]}),z&&e.jsxs("div",{className:"p-4 bg-red-50 border-2 border-red-200 rounded-xl text-red-700 text-sm font-semibold flex items-center gap-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-xl"}),e.jsx("span",{children:z})]})]})}const te=()=>{const{darkMode:a}=Z();return e.jsx("div",{className:`min-h-screen transition-colors duration-300 ${a?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-pulse",children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("div",{className:`h-6 rounded w-20 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-9 rounded w-96 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-5 rounded w-full max-w-2xl ${a?"bg-gray-700":"bg-gray-200"}`})]}),e.jsx("div",{className:"mb-6 border-b border-gray-700",children:e.jsx("div",{className:"flex gap-4",children:[1,2,3].map(l=>e.jsx("div",{className:`h-10 rounded-t w-24 ${a?"bg-gray-700":"bg-gray-200"}`},l))})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:`rounded-lg shadow p-6 ${a?"bg-gray-800":"bg-white"}`,children:[e.jsx("div",{className:`w-full aspect-video rounded-lg ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("div",{className:`h-10 rounded w-10 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`flex-1 h-10 rounded ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-10 rounded w-20 ${a?"bg-gray-700":"bg-gray-200"}`})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`rounded-lg shadow p-6 ${a?"bg-gray-800":"bg-white"}`,children:[e.jsx("div",{className:`h-6 rounded w-32 mb-4 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(l=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`h-4 rounded w-16 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-5 rounded w-24 ${a?"bg-gray-700":"bg-gray-200"}`})]},l))})]}),e.jsxs("div",{className:`rounded-lg shadow p-6 ${a?"bg-gray-800":"bg-white"}`,children:[e.jsx("div",{className:`h-6 rounded w-32 mb-4 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(l=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:`h-4 rounded w-20 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-4 rounded w-16 ${a?"bg-gray-700":"bg-gray-200"}`})]},l))})]}),e.jsxs("div",{className:`rounded-lg shadow p-6 ${a?"bg-gray-800":"bg-white"}`,children:[e.jsx("div",{className:`h-6 rounded w-32 mb-4 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(l=>e.jsx("div",{className:`h-10 rounded ${a?"bg-gray-700":"bg-gray-200"}`},l))})]})]})]})]})})};export{ae as C,te as L};
