import{j as e}from"./charts-8gUIbWxc.js";import{b as n,f as K,L as Q}from"./vendor-125d4HLq.js";import{u as A,c as b}from"./index-DB2kzkDV.js";import{c as V}from"./categoryService-BDjHKUQj.js";import{M as W}from"./Modal-6tiOT-7y.js";const X=()=>{const{darkMode:s}=A();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 animate-pulse",children:[1,2,3,4,5,6].map(u=>e.jsxs("div",{className:`rounded-2xl ring-1 shadow-sm overflow-hidden transition-colors duration-300 ${s?"bg-gray-800 ring-gray-700":"bg-white ring-gray-100"}`,children:[e.jsx("div",{className:`h-48 w-full ${s?"bg-gray-700":"bg-gray-200"}`}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsx("div",{className:`h-6 rounded w-3/4 ${s?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-4 rounded w-32 ${s?"bg-gray-700":"bg-gray-200"}`}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:`rounded-xl px-4 py-3 ${s?"bg-gray-900/50":"bg-slate-50/80"}`,children:[e.jsx("div",{className:`h-3 rounded w-16 mb-2 ${s?"bg-gray-600":"bg-gray-300"}`}),e.jsx("div",{className:`h-5 rounded w-8 ${s?"bg-gray-600":"bg-gray-300"}`})]}),e.jsxs("div",{className:`rounded-xl px-4 py-3 ${s?"bg-gray-900/50":"bg-slate-50/80"}`,children:[e.jsx("div",{className:`h-3 rounded w-16 mb-2 ${s?"bg-gray-600":"bg-gray-300"}`}),e.jsx("div",{className:`h-5 rounded w-8 ${s?"bg-gray-600":"bg-gray-300"}`})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:`h-3 rounded w-20 ${s?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-3 rounded w-10 ${s?"bg-gray-700":"bg-gray-200"}`})]}),e.jsx("div",{className:`h-2 rounded-full ${s?"bg-gray-700":"bg-gray-200"}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsx("div",{className:`h-9 rounded-lg ${s?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-9 rounded-lg ${s?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-9 rounded-lg ${s?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-9 rounded-lg ${s?"bg-gray-700":"bg-gray-200"}`})]})]})]},u))})})},R="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1000&q=80",M=[{value:"all",label:"كل الدورات"},{value:"active",label:"الدورات النشطة"},{value:"inactive",label:"الدورات غير النشطة"}];function se(){const{darkMode:s}=A(),[u,$]=n.useState([]),[C,D]=n.useState([]),[O,v]=n.useState(!0),[k,o]=n.useState(""),[P,c]=n.useState(!1),[j,E]=n.useState("create"),[d,g]=n.useState({name:"",category_id:"",link:"",active:!0,image:null}),[S,F]=n.useState(null),[_,N]=n.useState(!1),[h,I]=K(),y=n.useCallback(a=>a&&M.some(r=>r.value===a)?a:"all",[]),[p,L]=n.useState(()=>y(h.get("filter")));n.useEffect(()=>{T()},[]),n.useEffect(()=>{f()},[p]);const T=async()=>{try{const a=await V.getCategories();a.success&&D(a.data)}catch{}};n.useEffect(()=>{const a=y(h.get("filter"));L(r=>r===a?r:a)},[h,y]);const f=async()=>{var a,r,l;v(!0),o("");try{const t={};p==="active"?t.active=!0:p==="inactive"&&(t.active=!1);const i=await b.getCourses(t);i.success?$(i.data):$([])}catch(t){if((t==null?void 0:t.name)==="CanceledError"||(t==null?void 0:t.code)==="ERR_CANCELED"){v(!1);return}const i=((r=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.message)||(t==null?void 0:t.message);i&&!i.includes("timeout")&&!i.includes("canceled")?o(i):((l=t==null?void 0:t.response)==null?void 0:l.status)>=500?o("حدث خطأ في الخادم. يرجى المحاولة لاحقاً"):t!=null&&t.response||console.error("Network error loading courses:",t)}finally{v(!1)}},q=async a=>{var r,l;try{await b.toggleActive(a),await f()}catch(t){if((t==null?void 0:t.name)==="CanceledError"||(t==null?void 0:t.code)==="ERR_CANCELED")return;o(((l=(r=t.response)==null?void 0:r.data)==null?void 0:l.message)||"تعذر تحديث حالة الدورة")}},U=async a=>{var l,t;if(window.confirm("سيتم حذف الدورة وجميع بياناتها المرتبطة. هل تريد المتابعة؟"))try{await b.deleteCourse(a),await f()}catch(i){if((i==null?void 0:i.name)==="CanceledError"||(i==null?void 0:i.code)==="ERR_CANCELED")return;o(((t=(l=i.response)==null?void 0:l.data)==null?void 0:t.message)||"تعذر حذف الدورة")}},B=a=>{const r=y(a);L(r);const l=new URLSearchParams(h.toString());r==="all"?l.delete("filter"):l.set("filter",r),I(l)},G=()=>{var a;E("create"),F(null),g({name:"",category_id:((a=C[0])==null?void 0:a.id)??"",link:"",active:!0,image:null}),c(!0)},H=a=>{var r;E("edit"),F(a.id),g({name:a.name,category_id:((r=a.category)==null?void 0:r.id)??"",link:a.link??"",active:!!a.active,image:null}),c(!0)},m=a=>{const{name:r,value:l,type:t,checked:i,files:w}=a.target;g(r==="image"?x=>({...x,image:(w==null?void 0:w[0])??null}):t==="checkbox"?x=>({...x,[r]:i}):x=>({...x,[r]:l}))},z=async a=>{var r,l;a.preventDefault(),N(!0),o("");try{const t=new FormData;t.append("name",d.name),t.append("category_id",d.category_id),d.link&&t.append("link",d.link),t.append("active",d.active?"1":"0"),d.image&&t.append("image",d.image),j==="create"?await b.createCourse(t):S&&await b.updateCourse(S,t),c(!1),await f()}catch(t){if((t==null?void 0:t.name)==="CanceledError"||(t==null?void 0:t.code)==="ERR_CANCELED"){N(!1);return}o(((l=(r=t.response)==null?void 0:r.data)==null?void 0:l.message)||"تعذر حفظ بيانات الدورة")}finally{N(!1)}},J=a=>{a.currentTarget.onerror=null,a.currentTarget.src=R};return e.jsx("div",{className:`min-h-screen transition-colors duration-300 ${s?"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900":"bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30"}`,children:e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${s?"text-gray-100":"text-gray-900"}`,children:"الدورات التعليمية"}),e.jsx("p",{className:`mt-1 ${s?"text-gray-400":"text-gray-600"}`,children:"إدارة الدورات ومتابعة تقدم الدروس المرتبطة"})]}),e.jsx("button",{onClick:G,className:"px-5 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"+ دورة جديدة"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(a=>e.jsx("button",{onClick:()=>B(a.value),className:`px-4 py-2 rounded-lg text-sm font-bold transition ${p===a.value?"bg-blue-600 text-white shadow-md":s?"bg-gray-800 border border-gray-700 text-gray-300 hover:bg-gray-700":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:a.label},a.value))}),k&&e.jsx("div",{className:`p-4 border rounded-xl ${s?"bg-red-900/30 border-red-800 text-red-300":"bg-red-100 border-red-200 text-red-700"}`,children:k}),O?e.jsx(X,{}):u.length===0?e.jsx("div",{className:`rounded-xl shadow p-12 text-center transition-colors duration-300 ${s?"bg-gray-800 text-gray-500":"bg-white text-gray-500"}`,children:"لا توجد دورات في هذا القسم."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(a=>{const r=Number(a.progress??0),l=a.image_url||R,t=a.lessons_count??0,i=a.completed_lessons_count??0;return e.jsxs("div",{className:`group relative overflow-hidden rounded-2xl ring-1 shadow-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl ${s?"bg-gray-800 ring-gray-700":"bg-white ring-gray-100"}`,children:[e.jsxs("div",{className:"relative aspect-[16/9] overflow-hidden",children:[e.jsx("img",{src:l,alt:a.name,className:"h-full w-full object-cover transition-transform duration-700 group-hover:scale-105",onError:J}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/80 via-slate-900/20 to-transparent"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-between p-4 text-white",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("span",{className:`rounded-full px-3 py-1 text-[11px] font-medium tracking-wide ${a.active?"bg-emerald-500 text-white shadow-sm":"bg-white/20 text-white backdrop-blur"}`,children:a.active?"نشطة":"غير نشطة"}),e.jsxs("span",{className:"rounded-full bg-white/15 px-3 py-1 text-[11px] font-medium backdrop-blur",children:[t," درس"]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold leading-tight",children:a.name}),a.category&&e.jsx("p",{className:"mt-1 text-sm text-gray-200",children:a.category.name})]})]})]}),e.jsxs("div",{className:"space-y-5 p-6",children:[e.jsxs("div",{className:`grid grid-cols-2 gap-3 text-sm ${s?"text-gray-400":"text-gray-600"}`,children:[e.jsxs("div",{className:`rounded-xl px-4 py-3 ${s?"bg-gray-900/50":"bg-slate-50/80"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("i",{className:"fas fa-check-circle text-emerald-500"}),e.jsx("span",{children:"الدروس المكتملة"})]}),e.jsxs("div",{className:`mt-1 text-base font-semibold ${s?"text-gray-200":"text-gray-900"}`,children:[i," /"," ",t]})]}),e.jsxs("div",{className:`rounded-xl px-4 py-3 ${s?"bg-gray-900/50":"bg-slate-50/80"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("i",{className:"fas fa-bolt text-amber-500"}),e.jsx("span",{children:"معدل التقدم"})]}),e.jsxs("div",{className:`mt-1 text-base font-semibold ${s?"text-gray-200":"text-gray-900"}`,children:[r.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"مسار الإنجاز"}),e.jsxs("span",{children:[r.toFixed(1),"%"]})]}),e.jsx("div",{className:`h-2 overflow-hidden rounded-full ${s?"bg-gray-700":"bg-slate-200"}`,children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 transition-all duration-500",style:{width:`${Math.min(r,100)}%`}})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[e.jsx(Q,{to:`/courses/${a.id}`,className:`flex-1 min-w-[120px] rounded-lg border px-4 py-2.5 text-center text-sm font-medium transition ${s?"border-indigo-700 bg-indigo-900/30 text-indigo-300 hover:bg-indigo-900/50":"border-transparent bg-indigo-50 text-indigo-700 hover:bg-indigo-100"}`,children:"استعراض"}),e.jsx("button",{onClick:()=>H(a),className:`flex-1 min-w-[110px] rounded-lg border px-4 py-2.5 text-sm font-medium transition ${s?"border-gray-700 text-gray-300 hover:bg-gray-700":"border-slate-200 text-gray-700 hover:bg-slate-50"}`,children:"تعديل"}),e.jsx("button",{onClick:()=>q(a.id),className:`flex-1 min-w-[110px] rounded-lg px-4 py-2.5 text-sm font-medium transition ${a.active?"bg-slate-900 text-white hover:bg-slate-700":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:a.active?"إيقاف":"تفعيل"}),e.jsx("button",{onClick:()=>U(a.id),className:`flex-1 min-w-[110px] rounded-lg border px-4 py-2.5 text-sm font-medium transition ${s?"border-red-800 text-red-400 hover:bg-red-900/30":"border-red-200 text-red-600 hover:bg-red-50"}`,children:"حذف"})]})]})]},a.id)})}),e.jsx(W,{title:j==="create"?"إضافة دورة جديدة":"تعديل بيانات الدورة",isOpen:P,onClose:()=>c(!1),children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:`block text-sm font-bold mb-2 ${s?"text-gray-300":"text-gray-700"}`,children:"اسم الدورة"}),e.jsx("input",{id:"name",name:"name",type:"text",value:d.name,onChange:m,required:!0,className:`w-full px-4 py-2.5 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 transition-all ${s?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-transparent"}`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:`block text-sm font-bold mb-2 ${s?"text-gray-300":"text-gray-700"}`,children:"التصنيف"}),e.jsxs("select",{id:"category_id",name:"category_id",value:d.category_id,onChange:m,required:!0,className:`w-full px-4 py-2.5 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 font-medium transition-all ${s?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-transparent"}`,children:[e.jsx("option",{value:"",children:"-- اختر التصنيف --"}),C.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:`block text-sm font-bold mb-2 ${s?"text-gray-300":"text-gray-700"}`,children:"رابط الدورة (اختياري)"}),e.jsx("input",{id:"link",name:"link",type:"url",value:d.link,onChange:m,className:`w-full px-4 py-2.5 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 transition-all ${s?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-transparent"}`,placeholder:"https://"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image",className:`block text-sm font-bold mb-2 ${s?"text-gray-300":"text-gray-700"}`,children:"صورة الدورة (اختياري)"}),e.jsx("input",{id:"image",name:"image",type:"file",accept:"image/*",onChange:m,className:`w-full text-sm ${s?"text-gray-400":"text-gray-600"}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"active",name:"active",type:"checkbox",checked:d.active,onChange:m,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"active",className:`text-sm ${s?"text-gray-300":"text-gray-700"}`,children:"تفعيل الدورة فوراً"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:`px-5 py-2.5 rounded-lg border-2 font-bold transition-all ${s?"border-gray-700 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:_,className:"px-5 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-bold shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:_?"جاري الحفظ...":j==="create"?"حفظ الدورة":"تحديث الدورة"})]})]})})]})})}export{se as default};
