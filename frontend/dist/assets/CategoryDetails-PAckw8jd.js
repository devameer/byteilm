import{j as e}from"./charts-VrJjKkAO.js";import{i as M,c as L,r as o,L as y}from"./vendor-xoa7E_IC.js";import{u as O}from"./index-DX6VYCbL.js";import{c as h}from"./categoryService-D9Cc7qlW.js";import{M as R}from"./Modal-WCD_DT19.js";function U(){var $,w;const{darkMode:t}=O(),{id:b}=M(),C=L(),[a,S]=o.useState(null),[E,x]=o.useState(!0),[m,d]=o.useState(""),[_,c]=o.useState(!1),[g,u]=o.useState({name:"",image:null}),[p,f]=o.useState(!1);o.useEffect(()=>{j()},[b]);const j=async()=>{var r,n,i;x(!0),d("");try{const s=await h.getCategory(b);s.success&&S(s.data)}catch(s){if((s==null?void 0:s.name)==="CanceledError"||(s==null?void 0:s.code)==="ERR_CANCELED"){x(!1);return}const l=((n=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:n.message)||(s==null?void 0:s.message);l&&!l.includes("timeout")&&!l.includes("canceled")?d(l):((i=s==null?void 0:s.response)==null?void 0:i.status)>=500?d("حدث خطأ في الخادم. يرجى المحاولة لاحقاً"):s!=null&&s.response||console.error("Network error loading category details:",s)}finally{x(!1)}},k=()=>{a&&(u({name:a.name,image:null}),c(!0))},N=r=>{const{name:n,value:i,files:s}=r.target;u(n==="image"?l=>({...l,image:(s==null?void 0:s[0])??null}):l=>({...l,[n]:i}))},D=async r=>{var n,i;r.preventDefault(),f(!0);try{const s=new FormData;s.append("name",g.name),g.image&&s.append("image",g.image),await h.updateCategory(a.id,s),c(!1),await j()}catch(s){d(((i=(n=s.response)==null?void 0:n.data)==null?void 0:i.message)||"تعذر تحديث التصنيف")}finally{f(!1)}},F=async()=>{var n,i;if(!(!a||!window.confirm("سيتم حذف التصنيف. هل تريد المتابعة؟")))try{await h.deleteCategory(a.id),C("/categories")}catch(s){d(((i=(n=s.response)==null?void 0:n.data)==null?void 0:i.message)||"تعذر حذف التصنيف")}};if(E)return e.jsx("div",{className:`rounded-lg shadow p-12 text-center transition-colors duration-300 ${t?"bg-gray-800 text-gray-400":"bg-white text-gray-600"}`,children:"جاري تحميل البيانات..."});if(!a)return e.jsx("div",{className:`rounded-lg shadow p-12 text-center transition-colors duration-300 ${t?"bg-gray-800 text-gray-400":"bg-white text-gray-600"}`,children:m||"لم يتم العثور على التصنيف المطلوب"});const v=Number(a.progress??0);return e.jsx("div",{className:`min-h-screen transition-colors duration-300 ${t?"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900":"bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30"}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-3 text-sm ${t?"text-blue-400":"text-blue-600"}`,children:[e.jsx(y,{to:"/categories",className:"hover:underline",children:"التصنيفات"}),e.jsx("span",{className:t?"text-gray-500":"text-gray-400",children:"/"}),e.jsx("span",{children:a.name})]}),e.jsx("h1",{className:`mt-2 text-3xl font-bold ${t?"text-gray-100":"text-gray-900"}`,children:a.name}),e.jsx("p",{className:`mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:"نظرة تفصيلية على الدورات المرتبطة والتقدم المحقق"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"تعديل التصنيف"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"حذف التصنيف"})]})]}),m&&e.jsx("div",{className:`p-4 border rounded-lg ${t?"bg-red-900/30 border-red-800 text-red-300":"bg-red-100 border-red-200 text-red-700"}`,children:m}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:`lg:col-span-2 rounded-xl shadow-md p-6 space-y-6 transition-colors duration-300 ${t?"bg-gray-800":"bg-white"}`,children:[a.image_url&&e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-52 object-cover rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:`rounded-lg p-4 ${t?"bg-gray-900/50":"bg-gray-50"}`,children:[e.jsx("p",{className:"text-xs text-gray-500",children:"عدد الدورات"}),e.jsx("p",{className:`text-xl font-semibold ${t?"text-gray-100":"text-gray-900"}`,children:a.courses_count??0})]}),e.jsxs("div",{className:`rounded-lg p-4 ${t?"bg-gray-900/50":"bg-gray-50"}`,children:[e.jsx("p",{className:"text-xs text-gray-500",children:"تاريخ الإنشاء"}),e.jsx("p",{className:`text-xl font-semibold ${t?"text-gray-100":"text-gray-900"}`,children:new Date(a.created_at).toLocaleDateString("ar-EG")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`flex items-center justify-between text-sm ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("span",{children:"نسبة الإنجاز الإجمالية"}),e.jsxs("span",{className:`font-semibold ${t?"text-blue-400":"text-blue-600"}`,children:[v.toFixed(1),"%"]})]}),e.jsx("div",{className:`h-3 rounded-full overflow-hidden ${t?"bg-gray-700":"bg-gray-200"}`,children:e.jsx("div",{className:"h-full bg-blue-600 rounded-full",style:{width:`${Math.min(v,100)}%`}})})]})]}),e.jsxs("div",{className:`rounded-xl shadow-md p-6 space-y-4 transition-colors duration-300 ${t?"bg-gray-800":"bg-white"}`,children:[e.jsx("h2",{className:`text-lg font-semibold ${t?"text-gray-100":"text-gray-900"}`,children:"إدارة التصنيف"}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"يمكنك إضافة دورة جديدة وربطها بهذا التصنيف أو تحديث معلومات التصنيف الحالية."}),e.jsx(y,{to:`/courses?category_id=${a.id}`,className:"block text-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:"دورة جديدة لهذا التصنيف"})]})]}),e.jsxs("div",{className:`rounded-xl shadow-md p-6 space-y-4 transition-colors duration-300 ${t?"bg-gray-800":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:`text-xl font-semibold ${t?"text-gray-100":"text-gray-900"}`,children:"الدورات المرتبطة"}),e.jsxs("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:[(($=a.courses)==null?void 0:$.length)??0," دورة"]})]}),(w=a.courses)!=null&&w.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:a.courses.map(r=>{const n=Number(r.progress??0);return e.jsxs("div",{className:`border rounded-lg p-5 space-y-4 transition-colors duration-300 ${t?"border-gray-700":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:`text-lg font-semibold transition-colors duration-300 ${t?"text-gray-100":"text-gray-900"}`,children:r.name}),e.jsx("span",{className:`px-3 py-1 text-xs rounded-full transition-colors duration-300 ${r.active?t?"bg-green-900/30 text-green-300":"bg-green-100 text-green-700":t?"bg-gray-700 text-gray-400":"bg-gray-100 text-gray-600"}`,children:r.active?"نشطة":"غير نشطة"})]}),e.jsxs("div",{className:`text-sm space-y-1 transition-colors duration-300 ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsxs("div",{children:["عدد الدروس: ",r.lessons_count??0]}),e.jsxs("div",{children:["مكتملة: ",r.completed_lessons_count??0," / ",r.lessons_count??0]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs transition-colors duration-300 text-gray-500",children:[e.jsx("span",{children:"التقدم"}),e.jsxs("span",{children:[n.toFixed(1),"%"]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden transition-colors duration-300 ${t?"bg-gray-700":"bg-gray-200"}`,children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.min(n,100)}%`}})})]}),e.jsx(y,{to:`/courses/${r.id}`,className:`inline-flex justify-center items-center px-3 py-2 text-sm font-medium border rounded-lg transition-colors duration-300 ${t?"text-blue-400 border-blue-700 hover:bg-blue-900/30":"text-blue-600 border-blue-200 hover:bg-blue-50"}`,children:"عرض الدورة"})]},r.id)})}):e.jsx("div",{className:`text-center py-12 transition-colors duration-300 ${t?"text-gray-400":"text-gray-500"}`,children:"لا توجد دورات مرتبطة بهذا التصنيف حالياً."})]}),e.jsx(R,{title:"تعديل التصنيف",isOpen:_,onClose:()=>c(!1),children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:`block text-sm font-medium mb-2 transition-colors duration-300 ${t?"text-gray-300":"text-gray-700"}`,children:"اسم التصنيف"}),e.jsx("input",{id:"name",name:"name",type:"text",value:g.name,onChange:N,required:!0,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-300 ${t?"bg-gray-900 border-gray-700 text-gray-200":"border-gray-300"}`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image",className:`block text-sm font-medium mb-2 transition-colors duration-300 ${t?"text-gray-300":"text-gray-700"}`,children:"صورة جديدة (اختياري)"}),e.jsx("input",{id:"image",name:"image",type:"file",accept:"image/*",onChange:N,className:`w-full text-sm transition-colors duration-300 ${t?"text-gray-400":"text-gray-600"}`})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:`px-4 py-2 rounded-lg border transition-colors duration-300 ${t?"border-gray-700 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:p?"جاري التحديث...":"حفظ التغييرات"})]})]})})]})})}export{U as default};
