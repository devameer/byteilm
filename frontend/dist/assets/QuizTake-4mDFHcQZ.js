import{j as e}from"./charts-VrJjKkAO.js";import{i as P,c as L,r as l}from"./vendor-xoa7E_IC.js";import{b as h}from"./index-DX6VYCbL.js";import{F as B}from"./ClockIcon-Cuv4DrH5.js";const V=()=>{const{quizId:p}=P(),f=L(),[y,q]=l.useState(null),[b,z]=l.useState(null),[i,C]=l.useState([]),[s,x]=l.useState(0),[d,Q]=l.useState({}),[u,j]=l.useState(0),[_,w]=l.useState(!0),[v,N]=l.useState(!1),[A,E]=l.useState(null);l.useEffect(()=>{I()},[p]),l.useEffect(()=>{if(u<=0)return;const t=setInterval(()=>{j(r=>r<=1?(clearInterval(t),F(),0):r-1)},1e3);return()=>clearInterval(t)},[u]),l.useEffect(()=>{E(Date.now())},[s]);const I=async()=>{var t,r;try{w(!0);const n=(await h.post(`/quizzes/${p}/start`)).data;n.success?(z(n.data),q(n.data.quiz),C(n.data.questions),j(n.data.remaining_time)):(alert(n.message),f(-1))}catch(a){console.error("Error starting quiz:",a),alert("فشل بدء الاختبار: "+(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||a.message))}finally{w(!1)}},g=t=>{const r=i[s];Q({...d,[r.id]:t})},k=async(t,r)=>{const a=Math.floor((Date.now()-A)/1e3);try{await h.post(`/quiz-attempts/${b.attempt_id}/answer`,{question_id:t,answer:r,time_spent:a})}catch(n){console.error("Error saving answer:",n)}},T=()=>{const t=i[s],r=d[t.id];r!==void 0&&k(t.id,r),s<i.length-1&&x(s+1)},R=()=>{s>0&&x(s-1)},S=async()=>{var n,$;const t=i.length-Object.keys(d).length;if(t>0&&!confirm(`لديك ${t} أسئلة لم تجب عليها. هل أنت متأكد من التسليم؟`))return;const r=i[s],a=d[r.id];a!==void 0&&await k(r.id,a);try{N(!0),(await h.post(`/quiz-attempts/${b.attempt_id}/submit`)).data.success&&f(`/quiz-results/${b.attempt_id}`)}catch(m){console.error("Error submitting quiz:",m),alert("فشل تسليم الاختبار: "+((($=(n=m.response)==null?void 0:n.data)==null?void 0:$.message)||m.message))}finally{N(!1)}},F=async()=>{alert("انتهى وقت الاختبار. سيتم تسليم إجاباتك تلقائياً."),await S()},M=t=>{const r=Math.floor(t/3600),a=Math.floor(t%3600/60),n=t%60;return r>0?`${r}:${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`:`${a}:${String(n).padStart(2,"0")}`},D=()=>Object.keys(d).length;if(_)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!y||!i.length)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("p",{className:"text-red-600",children:"فشل تحميل الاختبار"})});const o=i[s],c=d[o.id],O=(s+1)/i.length*100;return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",dir:"rtl",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:y.title}),e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg ${u<300?"bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400":"bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"}`,children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{className:"font-mono text-lg font-bold",children:M(u)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsxs("span",{children:["السؤال ",s+1," من ",i.length]}),e.jsxs("span",{children:["تم الإجابة على ",D()," من ",i.length]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${O}%`}})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex-1",children:o.question}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 mr-4",children:[o.points," ",o.points===1?"نقطة":"نقاط"]})]})}),e.jsxs("div",{className:"space-y-3",children:[o.type==="multiple_choice"&&o.options.map((t,r)=>e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-lg cursor-pointer transition ${c===String(r)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300"}`,children:[e.jsx("input",{type:"radio",name:"answer",value:r,checked:c===String(r),onChange:a=>g(a.target.value),className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-900 dark:text-white flex-1",children:t})]},r)),o.type==="true_false"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-lg cursor-pointer transition ${c==="0"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300"}`,children:[e.jsx("input",{type:"radio",name:"answer",value:"0",checked:c==="0",onChange:t=>g(t.target.value),className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-900 dark:text-white",children:"صح"})]}),e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-lg cursor-pointer transition ${c==="1"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300"}`,children:[e.jsx("input",{type:"radio",name:"answer",value:"1",checked:c==="1",onChange:t=>g(t.target.value),className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-900 dark:text-white",children:"خطأ"})]})]}),(o.type==="fill_blank"||o.type==="short_answer")&&e.jsx("textarea",{value:c||"",onChange:t=>g(t.target.value),rows:4,className:"w-full p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-blue-500 focus:ring focus:ring-blue-200 dark:bg-gray-700 dark:text-white",placeholder:"اكتب إجابتك هنا..."})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:R,disabled:s===0,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:"السابق"}),e.jsx("div",{className:"flex-1 text-center",children:s===i.length-1?e.jsx("button",{onClick:S,disabled:v,className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-bold transition",children:v?"جاري التسليم...":"تسليم الاختبار"}):e.jsx("button",{onClick:T,className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"التالي"})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"انتقال سريع للأسئلة"}),e.jsx("div",{className:"grid grid-cols-10 gap-2",children:i.map((t,r)=>e.jsx("button",{onClick:()=>x(r),className:`w-10 h-10 rounded-lg flex items-center justify-center text-sm font-medium transition ${r===s?"bg-blue-600 text-white":d[t.id]!==void 0?"bg-green-100 dark:bg-green-900/20 text-green-600 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200"}`,children:r+1},t.id))})]})]})})};export{V as default};
