import{j as e}from"./charts-8gUIbWxc.js";import{b as n,L as D}from"./vendor-125d4HLq.js";import{u as C}from"./index-DB2kzkDV.js";import{c as x}from"./categoryService-BDjHKUQj.js";import{M as L}from"./Modal-6tiOT-7y.js";const _=()=>{const{darkMode:a}=C();return e.jsxs("div",{className:"space-y-6 animate-pulse",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`h-8 rounded w-64 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-5 rounded w-96 ${a?"bg-gray-700":"bg-gray-200"}`})]}),e.jsx("div",{className:`h-10 rounded-lg w-32 ${a?"bg-gray-700":"bg-gray-200"}`})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(g=>e.jsxs("div",{className:`rounded-2xl ring-1 shadow-sm overflow-hidden transition-colors duration-300 ${a?"bg-gray-800 ring-gray-700":"bg-white ring-gray-100"}`,children:[e.jsx("div",{className:`h-48 w-full ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsx("div",{className:`h-6 rounded w-3/4 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`h-4 rounded w-full ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-4 rounded w-5/6 ${a?"bg-gray-700":"bg-gray-200"}`})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`h-4 rounded w-20 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-4 rounded w-20 ${a?"bg-gray-700":"bg-gray-200"}`})]}),e.jsx("div",{className:`h-2 rounded-full ${a?"bg-gray-700":"bg-gray-200"}`,children:e.jsx("div",{className:`h-full rounded-full w-3/4 ${a?"bg-gray-600":"bg-gray-300"}`})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("div",{className:`h-9 rounded-lg flex-1 ${a?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-9 rounded-lg w-9 ${a?"bg-gray-700":"bg-gray-200"}`})]})]})]},g))})]})};function A(){const{darkMode:a}=C(),[g,S]=n.useState([]),[k,u]=n.useState(!0),[p,d]=n.useState(""),[E,o]=n.useState(!1),[b,y]=n.useState("create"),[m,c]=n.useState({name:"",image:null}),[f,j]=n.useState(null),[v,N]=n.useState(!1);n.useEffect(()=>{h()},[]);const h=async()=>{var t,r,l;u(!0),d("");try{const s=await x.getCategories();s.success&&S(s.data)}catch(s){if((s==null?void 0:s.name)==="CanceledError"||(s==null?void 0:s.code)==="ERR_CANCELED"){u(!1);return}const i=((r=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:r.message)||(s==null?void 0:s.message);i&&!i.includes("timeout")&&!i.includes("canceled")?d(i):((l=s==null?void 0:s.response)==null?void 0:l.status)>=500?d("حدث خطأ في الخادم. يرجى المحاولة لاحقاً"):s!=null&&s.response||console.error("Network error loading categories:",s)}finally{u(!1)}},w=()=>{y("create"),c({name:"",image:null}),j(null),o(!0)},M=t=>{y("edit"),c({name:t.name,image:null}),j(t.id),o(!0)},$=t=>{const{name:r,value:l,files:s}=t.target;if(r==="image"){c(i=>({...i,image:(s==null?void 0:s[0])??null}));return}c(i=>({...i,[r]:l}))},F=async t=>{var r,l;t.preventDefault(),N(!0);try{const s=new FormData;s.append("name",m.name),m.image&&s.append("image",m.image),b==="create"?await x.createCategory(s):f&&await x.updateCategory(f,s),o(!1),c({name:"",image:null}),await h()}catch(s){d(((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.message)||"تعذر حفظ التصنيف")}finally{N(!1)}},O=async t=>{var l,s;if(window.confirm("هل أنت متأكد من حذف هذا التصنيف؟"))try{await x.deleteCategory(t),await h()}catch(i){d(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"تعذر حذف التصنيف")}};return e.jsx("div",{className:`min-h-screen transition-colors duration-300 ${a?"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900":"bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30"}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${a?"text-gray-100":"text-gray-900"}`,children:"التصنيفات"}),e.jsx("p",{className:`mt-1 ${a?"text-gray-400":"text-gray-600"}`,children:"إدارة التصنيفات ومتابعة التقدم في الدورات المرتبطة بها"})]}),e.jsx("button",{onClick:w,className:"px-5 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"+ تصنيف جديد"})]}),p&&e.jsx("div",{className:`p-4 border rounded-lg ${a?"bg-red-900/30 border-red-800 text-red-300":"bg-red-100 border-red-200 text-red-700"}`,children:p}),k?e.jsx(_,{}):g.length===0?e.jsxs("div",{className:`rounded-lg shadow p-12 text-center space-y-3 transition-colors duration-300 ${a?"bg-gray-800 text-gray-400":"bg-white text-gray-600"}`,children:[e.jsx("p",{children:"لا توجد تصنيفات حتى الآن."}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"إنشاء أول تصنيف"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(t=>{var r;return e.jsxs("div",{className:`rounded-xl shadow-md p-6 flex flex-col space-y-4 transition-colors duration-300 ${a?"bg-gray-800":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:`text-xl font-semibold ${a?"text-gray-100":"text-gray-900"}`,children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(t),className:"text-blue-600 hover:text-blue-800 transition text-sm",children:"تعديل"}),e.jsx("button",{onClick:()=>O(t.id),className:"text-red-600 hover:text-red-800 transition text-sm",children:"حذف"})]})]}),t.image_url&&e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-40 object-cover rounded-lg"}),e.jsxs("div",{className:`space-y-2 text-sm ${a?"text-gray-400":"text-gray-600"}`,children:[e.jsxs("div",{children:["الدورات المرتبطة: ",t.courses_count??0]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"نسبة الإنجاز"}),e.jsxs("span",{children:[(r=t.progress)!=null&&r.toFixed?t.progress.toFixed(1):t.progress,"%"]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${a?"bg-gray-700":"bg-gray-200"}`,children:e.jsx("div",{className:"h-full bg-blue-600 rounded-full transition-all",style:{width:`${t.progress||0}%`}})})]})]}),e.jsx("div",{className:"flex-1"}),e.jsx(D,{to:`/categories/${t.id}`,className:"inline-flex justify-center items-center px-4 py-2 text-sm font-medium text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50 transition",children:"عرض التفاصيل"})]},t.id)})}),e.jsx(L,{title:b==="create"?"إضافة تصنيف جديد":"تعديل التصنيف",isOpen:E,onClose:()=>o(!1),children:e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"اسم التصنيف"}),e.jsx("input",{id:"name",name:"name",type:"text",value:m.name,onChange:$,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"أدخل اسم التصنيف"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700 mb-2",children:"صورة التصنيف (اختياري)"}),e.jsx("input",{id:"image",name:"image",type:"file",accept:"image/*",onChange:$,className:"w-full text-sm text-gray-600"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"يمكن رفع صورة بصيغة JPG أو PNG بحجم أقصى 2MB"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition disabled:opacity-50",children:v?"جاري الحفظ...":b==="create"?"حفظ التصنيف":"تحديث التصنيف"})]})]})})]})})}export{A as default};
