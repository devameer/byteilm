import{j as e}from"./charts-VrJjKkAO.js";import{r as a}from"./vendor-xoa7E_IC.js";import{b as l,F as Z}from"./index-DX6VYCbL.js";import{F as h}from"./CheckCircleIcon-B3US9B7Y.js";import{F as v}from"./XCircleIcon-9LFgBkgf.js";import{F as B}from"./ClockIcon-Cuv4DrH5.js";import{F as I}from"./ArrowPathIcon-CglTX8eZ.js";import{F as O}from"./ChartBarIcon-uHSdAZ-F.js";import{F as U}from"./TrashIcon-CwpbpcVG.js";function W({title:c,titleId:n,...i},g){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":n},i),c?a.createElement("title",{id:n},c):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const G=a.forwardRef(W),se=()=>{const[c,n]=a.useState([]),[i,g]=a.useState([]),[_,f]=a.useState(!0),[r,u]=a.useState(null),[S,b]=a.useState(!1),[C,j]=a.useState(!1),[F,y]=a.useState(!1),[$,E]=a.useState([]),[d,R]=a.useState(null),[o,N]=a.useState({}),[p,w]=a.useState({});a.useEffect(()=>{x()},[]);const x=async()=>{try{f(!0);const s=await l.get("/integrations");s.data.success&&(n(s.data.data.connected),g(s.data.data.available))}catch(s){console.error("Error fetching integrations:",s)}finally{f(!1)}},L=async s=>{try{const t=await l.get(`/integrations/auth/${s}`);t.data.success&&(window.location.href=t.data.data.auth_url)}catch(t){console.error("Error connecting integration:",t),alert("فشل الربط. حاول مرة أخرى.")}},D=async s=>{if(confirm("هل أنت متأكد من فصل هذا التكامل؟"))try{(await l.delete(`/integrations/${s}`)).data.success&&(alert("تم فصل التكامل بنجاح"),x())}catch(t){console.error("Error disconnecting integration:",t),alert("فشل فصل التكامل. حاول مرة أخرى.")}},M=async s=>{try{w({...p,[s]:!0});const t=await l.post(`/integrations/${s}/test`);t.data.success?alert("الاتصال يعمل بنجاح ✓"):alert("فشل اختبار الاتصال: "+t.data.message)}catch(t){console.error("Error testing connection:",t),alert("فشل اختبار الاتصال")}finally{w({...p,[s]:!1})}},T=async s=>{try{N({...o,[s]:!0});const t=await l.post(`/integrations/${s}/sync`);t.data.success?(alert("تمت المزامنة بنجاح ✓"),x()):alert("فشلت المزامنة: "+t.data.message)}catch(t){console.error("Error syncing:",t),alert("فشلت المزامنة")}finally{N({...o,[s]:!1})}},k=async(s,t)=>{try{(await l.put(`/integrations/${s}`,t)).data.success&&(alert("تم تحديث الإعدادات بنجاح"),x(),b(!1))}catch(m){console.error("Error updating settings:",m),alert("فشل تحديث الإعدادات")}},z=async s=>{try{const t=await l.get(`/integrations/${s}/logs`);t.data.success&&(E(t.data.data.data),j(!0))}catch(t){console.error("Error fetching logs:",t)}},q=async s=>{try{const t=await l.get(`/integrations/${s}/statistics`);t.data.success&&(R(t.data.data),y(!0))}catch(t){console.error("Error fetching statistics:",t)}},A=s=>{if(!s)return"لم يتم المزامنة بعد";const t=new Date(s);return new Intl.RelativeTimeFormat("ar",{numeric:"auto"}).format(Math.round((t-new Date)/(1e3*60*60*24)),"day")};return _?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",dir:"rtl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"التكاملات الخارجية"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"قم بربط تطبيقك مع خدمات خارجية لزيادة الإنتاجية"})]}),c.length>0&&e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"التكاملات المتصلة"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(s=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-2 border-green-200 dark:border-green-700",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:s.provider_icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s.provider_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.is_active?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(h,{className:"w-4 h-4"}),"نشط"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-red-600 dark:text-red-400",children:[e.jsx(v,{className:"w-4 h-4"}),"غير نشط"]}),s.auto_sync&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:"• مزامنة تلقائية"})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsxs("span",{children:["آخر مزامنة: ",A(s.last_sync_at)]})]}),s.error_count>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.error_count," خطأ"]})]}),s.last_error&&e.jsx("p",{className:"text-xs text-red-500 dark:text-red-400 mt-1",children:s.last_error})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>T(s.id),disabled:o[s.id]||!s.is_active,className:"flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition text-sm",children:[e.jsx(I,{className:`w-4 h-4 ${o[s.id]?"animate-spin":""}`}),"مزامنة"]}),e.jsxs("button",{onClick:()=>M(s.id),disabled:p[s.id],className:"flex items-center justify-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition text-sm",children:[e.jsx(h,{className:"w-4 h-4"}),"اختبار"]}),e.jsxs("button",{onClick:()=>{u(s),b(!0)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),"إعدادات"]}),e.jsxs("button",{onClick:()=>{u(s),q(s.id)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),"إحصائيات"]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{onClick:()=>{u(s),z(s.id)},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:["عرض السجلات (",s.logs_count,")"]}),e.jsxs("button",{onClick:()=>D(s.id),className:"flex items-center gap-1 text-sm text-red-600 dark:text-red-400 hover:underline",children:[e.jsx(U,{className:"w-4 h-4"}),"فصل"]})]})]},s.id))})]}),i.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"التكاملات المتاحة"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("span",{className:"text-4xl",children:s.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.description})]})]}),e.jsx("ul",{className:"space-y-2 mb-4",children:s.features.map((t,m)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(h,{className:"w-4 h-4 text-green-500"}),t]},m))}),e.jsx("button",{onClick:()=>L(s.provider),className:"w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium",children:"ربط الآن"})]},s.provider))})]}),S&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:["إعدادات ",r.provider_name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",defaultChecked:r.auto_sync,onChange:s=>{k(r.id,{auto_sync:s.target.checked})},className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تفعيل المزامنة التلقائية"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",defaultChecked:r.is_active,onChange:s=>{k(r.id,{is_active:s.target.checked})},className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تفعيل التكامل"})]})]}),e.jsx("div",{className:"flex gap-3 mt-6",children:e.jsx("button",{onClick:()=>b(!1),className:"flex-1 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"إغلاق"})})]})}),F&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6 max-h-[80vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:["إحصائيات ",r==null?void 0:r.provider_name]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"إجمالي الطلبات"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:d.total_requests})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"معدل النجاح"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[d.success_rate,"%"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"متوسط المدة"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:[Math.round(d.average_duration),"ms"]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"الأخطاء"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:d.failed_requests})]})]}),e.jsx("button",{onClick:()=>y(!1),className:"w-full py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"إغلاق"})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full p-6 max-h-[80vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:["سجلات ",r==null?void 0:r.provider_name]}),e.jsx("div",{className:"space-y-2",children:$.map(s=>e.jsx("div",{className:`p-4 rounded-lg border ${s.status==="success"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.status==="success"?e.jsx(h,{className:"w-5 h-5 text-green-600"}):e.jsx(v,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s.action}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s.formatted_duration||s.duration_ms+"ms",")"]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.message}),s.error_details&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:s.error_details.error})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString("ar-SA")})]})},s.id))}),e.jsx("button",{onClick:()=>j(!1),className:"w-full mt-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"إغلاق"})]})})]})};export{se as default};
