import{j as e}from"./charts-8gUIbWxc.js";import{i as C,c as E,b as c,L as h}from"./vendor-125d4HLq.js";import{u as $}from"./index-Ca2M97Gg.js";import{t as o}from"./taskService-CyLXNRay.js";import"./apiHelpers-CkzhrEqp.js";const T=[{value:"pending",label:"قيد الانتظار"},{value:"in_progress",label:"قيد التنفيذ"},{value:"completed",label:"مكتملة"},{value:"cancelled",label:"ملغاة"}],S=[{value:"low",label:"منخفضة"},{value:"medium",label:"متوسطة"},{value:"high",label:"مرتفعة"},{value:"urgent",label:"عاجلة"}];function M(){var b;const{darkMode:n}=$(),{id:y}=C(),j=E(),[s,f]=c.useState(null),[v,m]=c.useState(!0),[u,d]=c.useState(""),[p,i]=c.useState(!1);c.useEffect(()=>{x()},[y]);const x=async()=>{var t,r,l;m(!0),d("");try{const a=await o.getTask(y);a.success&&f(a.data)}catch(a){if((a==null?void 0:a.name)==="CanceledError"||(a==null?void 0:a.code)==="ERR_CANCELED"){m(!1);return}const g=((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||(a==null?void 0:a.message);g&&!g.includes("timeout")&&!g.includes("canceled")?d(g):((l=a==null?void 0:a.response)==null?void 0:l.status)>=500?d("حدث خطأ في الخادم. يرجى المحاولة لاحقاً"):a!=null&&a.response||console.error("Network error loading task details:",a)}finally{m(!1)}},N=async t=>{var r,l;if(s){i(!0);try{await o.updateTask(s.id,{status:t.target.value}),await x()}catch(a){d(((l=(r=a.response)==null?void 0:r.data)==null?void 0:l.message)||"تعذر تحديث حالة المهمة")}finally{i(!1)}}},w=async t=>{var r,l;if(s){i(!0);try{await o.updateTask(s.id,{priority:t.target.value}),await x()}catch(a){d(((l=(r=a.response)==null?void 0:r.data)==null?void 0:l.message)||"تعذر تحديث أولوية المهمة")}finally{i(!1)}}},k=async()=>{var r,l;if(!(!s||!window.confirm("سيتم حذف المهمة. هل تريد المتابعة؟")))try{await o.deleteTask(s.id),j("/tasks")}catch(a){d(((l=(r=a.response)==null?void 0:r.data)==null?void 0:l.message)||"تعذر حذف المهمة")}},_=async()=>{var t,r;if(!(!s||s.status==="completed")){i(!0);try{await o.completeTask(s.id),await x()}catch(l){d(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.message)||"تعذر إكمال المهمة")}finally{i(!1)}}};return v?e.jsx("div",{className:`rounded-lg shadow p-12 text-center transition-colors duration-300 ${n?"bg-gray-800 text-gray-400":"bg-white text-gray-600"}`,children:"جاري تحميل بيانات المهمة..."}):s?e.jsx("div",{className:`min-h-screen transition-colors duration-300 ${n?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-3 text-sm ${n?"text-blue-400":"text-blue-600"}`,children:[e.jsx(h,{to:"/tasks",className:"hover:underline",children:"المهام"}),e.jsx("span",{className:n?"text-gray-500":"text-gray-400",children:"/"}),e.jsx("span",{children:s.title})]}),e.jsx("h1",{className:`mt-2 text-3xl font-bold ${n?"text-gray-100":"text-gray-900"}`,children:s.title})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.status!=="completed"&&e.jsx("button",{onClick:_,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",disabled:p,children:"إكمال المهمة"}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"حذف المهمة"})]})]}),u&&e.jsx("div",{className:`p-4 border rounded-lg ${n?"bg-red-900/30 border-red-800 text-red-300":"bg-red-100 border-red-200 text-red-700"}`,children:u}),e.jsxs("div",{className:`rounded-xl shadow-md p-6 space-y-4 transition-colors duration-300 ${n?"bg-gray-800":"bg-white"}`,children:[s.description&&e.jsx("p",{className:`text-sm ${n?"text-gray-300":"text-gray-700"}`,children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-600",children:[s.scheduled_date&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"تاريخ التنفيذ"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.scheduled_date})]}),s.due_date&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"تاريخ الاستحقاق"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.due_date})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"حالة المهمة"}),e.jsx("select",{id:"status",name:"status",value:s.status,onChange:N,disabled:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:T.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-2",children:"أولوية المهمة"}),e.jsx("select",{id:"priority",name:"priority",value:s.priority??"medium",onChange:w,disabled:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:S.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-600",children:[s.project&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"المشروع المرتبط"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:e.jsx(h,{to:`/projects/${s.project.id}`,className:"text-blue-600 hover:underline",children:s.project.name})})]}),s.course&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الدورة المرتبطة"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:e.jsx(h,{to:`/courses/${s.course.id}`,className:"text-blue-600 hover:underline",children:s.course.name})})]}),s.lesson&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الدرس المرتبط"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.lesson.name})]}),s.link&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"رابط خارجي"}),e.jsx("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"فتح الرابط"})]}),s.estimated_duration&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"المدة المتوقعة"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[s.estimated_duration," دقيقة"]})]})]}),((b=s.tags)==null?void 0:b.length)>0&&e.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-gray-600",children:s.tags.map(t=>e.jsxs("span",{className:"px-3 py-1 bg-gray-100 rounded-full",children:["#",t]},t))}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["تم إنشاء المهمة في: ",new Date(s.created_at).toLocaleString("ar-EG")]}),e.jsxs("p",{children:["آخر تحديث: ",new Date(s.updated_at).toLocaleString("ar-EG")]})]})]})]})}):e.jsx("div",{className:`rounded-lg shadow p-12 text-center transition-colors duration-300 ${n?"bg-gray-800 text-gray-400":"bg-white text-gray-600"}`,children:u||"لم يتم العثور على المهمة المطلوبة"})}export{M as default};
