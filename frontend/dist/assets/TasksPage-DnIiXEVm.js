import{j as e}from"./charts-8gUIbWxc.js";import{b as u,L as F}from"./vendor-125d4HLq.js";import{c as M,u as p}from"./index-DB2kzkDV.js";import{t as v}from"./taskService-CLL6yYg6.js";import{p as S}from"./projectService-Cg9rdHpu.js";import{l as R}from"./lessonService-YJYph0J7.js";import{M as O}from"./Modal-6tiOT-7y.js";import{S as P}from"./SearchableSelect-BpMduwaQ.js";import"./apiHelpers-CkzhrEqp.js";function L({toast:r,onClose:t}){if(u.useEffect(()=>{if(!r)return;const d=window.setTimeout(t,3e3);return()=>window.clearTimeout(d)},[r,t]),!r)return null;const s={success:"bg-green-600",error:"bg-red-600",info:"bg-indigo-600"};return e.jsx("div",{className:`${s[r.tone]||s.info} fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 text-white rounded-lg shadow-lg z-50`,children:r.message})}function D(){const[r,t]=u.useState(null),s=u.useCallback((o,g="info")=>{t({message:o,tone:g})},[]),d=u.useCallback(()=>{t(null)},[]);return{toast:r,show:s,dismiss:d}}function I(r={}){const[t,s]=u.useState(r.data||null),[d,o]=u.useState(!1),[g,c]=u.useState(null),x=u.useCallback(async a=>{var b,f;o(!0),c(null);try{const i=await(typeof a=="function"?a():a);return s(i),i}catch(i){if((i==null?void 0:i.name)==="CanceledError"||(i==null?void 0:i.code)==="ERR_CANCELED"){o(!1);return}const j=((f=(b=i==null?void 0:i.response)==null?void 0:b.data)==null?void 0:f.message)||(i==null?void 0:i.message)||"حدث خطأ أثناء تحميل البيانات";throw c(j),i}finally{o(!1)}},[]),l=u.useCallback(()=>{s(r.data||null),o(!1),c(null)},[r.data]);return{data:t,loading:d,error:g,run:x,reset:l}}function V(r,t=300){const[s,d]=u.useState(r);return u.useEffect(()=>{const o=setTimeout(()=>{d(r)},t);return()=>{clearTimeout(o)}},[r,t]),s}const k={search:"",status:"all",priority:"",is_lesson:"",project_id:"",course_id:"",quick_date:"",type:"",date_from:"",date_to:"",order_by:"scheduled_date",order_direction:"asc"},T=[{value:"all",label:"كل الحالات"},{value:"pending",label:"قيد الانتظار"},{value:"in_progress",label:"قيد التنفيذ"},{value:"completed",label:"مكتملة"},{value:"cancelled",label:"ملغاة"}],E=[{value:"",label:"كل المستويات"},{value:"urgent",label:"عاجلة"},{value:"high",label:"مرتفعة"},{value:"medium",label:"متوسطة"},{value:"low",label:"منخفضة"}],q=[{value:"",label:"بدون"},{value:"today",label:"اليوم"},{value:"tomorrow",label:"الغد"},{value:"this_week",label:"هذا الأسبوع"},{value:"next_week",label:"الأسبوع القادم"},{value:"overdue",label:"متأخرة"}],w={total:0,pending:0,in_progress:0,completed:0,overdue:0};function B(r=k){const[t,s]=u.useState(r),d=V(t.search,350),{data:o,loading:g,error:c,run:x}=I({data:{items:[],stats:w,meta:{}}}),l=u.useCallback(async()=>{var f;try{const i=await v.list({...t,search:d,with_stats:!0});return i.success?{items:Array.isArray(i.data)?i.data:((f=i.data)==null?void 0:f.items)??[],stats:{...w,...i.stats||{}},meta:i.meta??{}}:{items:[],stats:w,meta:{}}}catch(i){if((i==null?void 0:i.name)==="CanceledError"||(i==null?void 0:i.code)==="ERR_CANCELED")return{items:[],stats:w,meta:{}};throw i}},[d,t]);return u.useEffect(()=>{x(l)},[l,x]),{filters:t,setFilter:(f,i)=>{s(j=>({...j,[f]:i}))},resetFilters:()=>s(k),tasks:o.items,stats:o.stats,meta:o.meta,loading:g,error:c,refresh:()=>x(l)}}const C={title:"",description:"",priority:"medium",status:"pending",scheduled_date:"",due_date:"",source_type:"none",project_id:"",course_id:"",lesson_id:"",estimated_duration:"",link:""};function Q({onSuccess:r}){const[t,s]=u.useState(!1),[d,o]=u.useState("create"),[g,c]=u.useState(C),[x,l]=u.useState(!1),[a,b]=u.useState({projects:[],courses:[],lessons:[]}),[f,i]=u.useState(null);return u.useEffect(()=>{const n=m=>m?m.success&&Array.isArray(m.data)?m.data:Array.isArray(m)?m:m.data??[]:[];(async()=>{try{const[m,h]=await Promise.all([S.getProjects({status:"active"}),M.getCourses({active:!0})]);b(y=>({...y,projects:n(m),courses:n(h)}))}catch(m){if((m==null?void 0:m.name)==="CanceledError"||(m==null?void 0:m.code)==="ERR_CANCELED")return;console.error("Failed to load lookups",m)}})()},[]),u.useEffect(()=>{g.source_type==="lesson"&&g.course_id?R.getLessons({course_id:g.course_id}).then(n=>{const m=Array.isArray(n)?n:n!=null&&n.success?n.data:(n==null?void 0:n.data)??[];b(h=>({...h,lessons:m}))}).catch(()=>{b(n=>({...n,lessons:[]}))}):(b(n=>({...n,lessons:[]})),g.lesson_id&&c(n=>({...n,lesson_id:""})))},[g.course_id,g.source_type]),{modalOpen:t,openCreate:()=>{o("create"),c(C),i(null),s(!0)},openEdit:n=>{o("edit"),i(n.id);const m=n.lesson_id?"lesson":n.course_id?"course":n.project_id?"project":"none";c({title:n.title??"",description:n.description??"",priority:n.priority??"medium",status:n.status??"pending",scheduled_date:n.scheduled_date??"",due_date:n.due_date??"",source_type:m,project_id:n.project_id??"",course_id:n.course_id??"",lesson_id:n.lesson_id??"",estimated_duration:n.estimated_duration??"",link:n.link??""}),s(!0)},close:()=>s(!1),mode:d,submitting:x,formState:g,setFormState:c,lookups:a,submit:async n=>{n.preventDefault(),l(!0);try{d==="create"?await v.create(g):f&&await v.update(f,g),s(!1),r==null||r()}finally{l(!1)}}}}function U({filters:r,onChange:t,onReset:s}){const{darkMode:d}=p();return e.jsxs("div",{className:`rounded-2xl border-2 p-6 space-y-6 shadow-sm transition-colors duration-300 ${d?"bg-gray-800 border-gray-700":"bg-white border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:`text-lg font-black flex items-center gap-2 ${d?"text-gray-100":"text-gray-900"}`,children:[e.jsx("i",{className:"fas fa-filter text-blue-600"}),e.jsx("span",{children:"تصفية المهام"})]}),e.jsxs("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-bold text-red-600 hover:text-red-700 border-2 border-red-200 rounded-lg hover:bg-red-50 transition-all",children:[e.jsx("i",{className:"fas fa-redo ml-1"}),"إعادة التعيين"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-bold mb-2 ${d?"text-gray-300":"text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-search ml-1 text-blue-600"}),"بحث"]}),e.jsx("input",{type:"search",value:r.search,onChange:o=>t("search",o.target.value),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 transition-all ${d?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"ابحث عن مهمة..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-bold mb-2 ${d?"text-gray-300":"text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-circle ml-1 text-blue-600"}),"الحالة"]}),e.jsx("select",{value:r.status,onChange:o=>t("status",o.target.value),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${d?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-blue-500"}`,children:T.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-bold mb-2 ${d?"text-gray-300":"text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-flag ml-1 text-blue-600"}),"الأولوية"]}),e.jsx("select",{value:r.priority,onChange:o=>t("priority",o.target.value),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${d?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-blue-500"}`,children:E.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-bold mb-2 ${d?"text-gray-300":"text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-calendar ml-1 text-blue-600"}),"فلتر زمني"]}),e.jsx("select",{value:r.quick_date,onChange:o=>t("quick_date",o.target.value),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${d?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-blue-500"}`,children:q.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]})]}),e.jsx("div",{className:`flex flex-wrap items-center gap-3 pt-4 border-t-2 ${d?"border-gray-700":"border-gray-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-bold ${d?"text-gray-300":"text-gray-700"}`,children:"ترتيب حسب:"}),e.jsxs("select",{value:r.order_by,onChange:o=>t("order_by",o.target.value),className:`border-2 rounded-lg px-3 py-2 text-sm font-medium focus:ring-2 focus:ring-blue-500 ${d?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"border-gray-300 focus:border-blue-500"}`,children:[e.jsx("option",{value:"scheduled_date",children:"التاريخ"}),e.jsx("option",{value:"priority",children:"الأولوية"}),e.jsx("option",{value:"title",children:"العنوان"})]}),e.jsxs("button",{type:"button",onClick:()=>t("order_direction",r.order_direction==="asc"?"desc":"asc"),className:`px-4 py-2 border-2 rounded-lg font-bold text-sm transition-all ${d?"border-gray-700 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("i",{className:`fas fa-arrow-${r.order_direction==="asc"?"up":"down"} ml-1`}),r.order_direction==="asc"?"تصاعدي":"تنازلي"]})]})})]})}const z=[{key:"total",label:"الإجمالي",icon:"fa-th",bgColor:"bg-blue-100",textColor:"text-blue-600"},{key:"pending",label:"قيد الانتظار",icon:"fa-clock",bgColor:"bg-yellow-100",textColor:"text-yellow-600"},{key:"in_progress",label:"قيد التنفيذ",icon:"fa-spinner",bgColor:"bg-blue-100",textColor:"text-blue-600"},{key:"completed",label:"مكتملة",icon:"fa-check-circle",bgColor:"bg-green-100",textColor:"text-green-600"},{key:"overdue",label:"متأخرة",icon:"fa-exclamation-triangle",bgColor:"bg-red-100",textColor:"text-red-600"}];function G({stats:r}){const{darkMode:t}=p();return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 xl:grid-cols-5 gap-4",children:z.map(s=>e.jsx("div",{className:`rounded-xl border p-6 hover:shadow-lg transition-all duration-300 group ${t?"bg-gray-800 border-gray-700":"bg-white border-gray-100"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm mb-1 font-medium ${t?"text-gray-400":"text-gray-600"}`,children:s.label}),e.jsx("p",{className:`text-3xl font-black ${t?"text-gray-100":"text-gray-900"}`,children:(r==null?void 0:r[s.key])??0})]}),e.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform ${t?`${s.bgColor.replace("100","900/30")}`:s.bgColor}`,children:e.jsx("i",{className:`fas ${s.icon} ${s.textColor} text-2xl`})})]})},s.key))})}const K={pending:{text:"قيد الانتظار",classes:"bg-yellow-100 text-yellow-700 border-yellow-200",icon:"fa-clock"},in_progress:{text:"قيد التنفيذ",classes:"bg-blue-100 text-blue-700 border-blue-200",icon:"fa-spinner"},completed:{text:"مكتملة",classes:"bg-green-100 text-green-700 border-green-200",icon:"fa-check-circle"},cancelled:{text:"ملغاة",classes:"bg-gray-100 text-gray-600 border-gray-200",icon:"fa-ban"}},Y={urgent:{text:"عاجلة",classes:"bg-red-50 text-red-700 border-red-200",icon:"fa-fire"},high:{text:"عالية",classes:"bg-orange-50 text-orange-700 border-orange-200",icon:"fa-arrow-up"},medium:{text:"متوسطة",classes:"bg-blue-50 text-blue-700 border-blue-200",icon:"fa-minus"},low:{text:"منخفضة",classes:"bg-green-50 text-green-700 border-green-200",icon:"fa-arrow-down"}};function H({task:r,onEdit:t,onComplete:s,onQuickView:d,selected:o,onToggleSelect:g}){const{darkMode:c}=p(),x=K[r.status],l=Y[r.priority];return e.jsxs("div",{className:`border-2 rounded-xl p-5 space-y-4 hover:shadow-md transition-all duration-300 group relative ${o?"border-blue-500 shadow-lg":c?"bg-gray-800 border-gray-700":"bg-white border-gray-100"}`,children:[g&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("input",{type:"checkbox",checked:o,onChange:()=>g(r.id),className:"w-5 h-5 rounded border-2 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex-1 pr-8",children:[e.jsx("h3",{className:`text-lg font-bold group-hover:text-blue-600 transition-colors mb-2 ${c?"text-gray-100":"text-gray-900"}`,children:r.title}),r.description&&e.jsx("p",{className:`text-sm line-clamp-2 leading-relaxed ${c?"text-gray-400":"text-gray-600"}`,children:r.description})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[x&&e.jsxs("span",{className:`px-3 py-1.5 rounded-lg text-xs font-bold border-2 ${x.classes}`,children:[e.jsx("i",{className:`fas ${x.icon} mr-1`}),x.text]}),l&&e.jsxs("span",{className:`px-3 py-1.5 rounded-lg text-xs font-bold border-2 ${l.classes}`,children:[e.jsx("i",{className:`fas ${l.icon} mr-1`}),l.text]})]}),e.jsxs("div",{className:`space-y-2 text-sm ${c?"text-gray-400":"text-gray-600"}`,children:[r.scheduled_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${c?"bg-blue-900/30":"bg-blue-50"}`,children:e.jsx("i",{className:"fas fa-calendar text-blue-600 text-xs"})}),e.jsx("span",{className:"font-medium",children:r.scheduled_date})]}),r.project&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${c?"bg-purple-900/30":"bg-purple-50"}`,children:e.jsx("i",{className:"fas fa-briefcase text-purple-600 text-xs"})}),e.jsx("span",{className:"font-medium",children:r.project.name})]}),r.course&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${c?"bg-indigo-900/30":"bg-indigo-50"}`,children:e.jsx("i",{className:"fas fa-graduation-cap text-indigo-600 text-xs"})}),e.jsx("span",{className:"font-medium",children:r.course.name})]})]}),e.jsxs("div",{className:`flex items-center gap-2 pt-3 border-t ${c?"border-gray-700":"border-gray-100"}`,children:[d&&e.jsxs("button",{type:"button",onClick:()=>d(r),className:"flex-1 px-3 py-2 border-2 border-indigo-200 text-indigo-600 rounded-lg hover:bg-indigo-50 transition-all font-bold text-sm",children:[e.jsx("i",{className:"fas fa-eye ml-1"}),"عرض سريع"]}),e.jsxs("button",{type:"button",onClick:()=>t==null?void 0:t(r),className:`flex-1 px-3 py-2 border-2 rounded-lg transition-all font-bold text-sm ${c?"border-gray-700 text-gray-300 hover:bg-gray-700":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"fas fa-edit ml-1"}),"تعديل"]}),r.status!=="completed"&&e.jsxs("button",{type:"button",onClick:()=>s==null?void 0:s(r),className:"flex-1 px-3 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all font-bold text-sm",children:[e.jsx("i",{className:"fas fa-check ml-1"}),"إكمال"]})]})]})}function J({tasks:r,onEdit:t,onComplete:s,onQuickView:d,selectedTasks:o=[],onToggleSelect:g,viewMode:c="grid"}){const{darkMode:x}=p();return r.length?e.jsx("div",{className:c==="grid"?"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4":"space-y-4",children:r.map(l=>e.jsx(H,{task:l,onEdit:t,onComplete:s,onQuickView:d,selected:o.includes(l.id),onToggleSelect:g},l.id))}):e.jsxs("div",{className:`rounded-2xl border-2 p-12 text-center transition-colors duration-300 ${x?"bg-gray-800 border-gray-700":"bg-white border-gray-100"}`,children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 ${x?"bg-gray-900":"bg-gray-100"}`,children:e.jsx("i",{className:`fas fa-tasks text-3xl ${x?"text-gray-600":"text-gray-400"}`})}),e.jsx("p",{className:`text-lg font-medium ${x?"text-gray-400":"text-gray-500"}`,children:"لا توجد مهام ضمن هذا الفلتر"})]})}function W({isOpen:r,mode:t,formState:s,onChange:d,onSubmit:o,onClose:g,submitting:c,lookups:x}){const{darkMode:l}=p();return e.jsx(O,{title:t==="create"?"مهمة جديدة":"تعديل المهمة",isOpen:r,onClose:g,size:"md",children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"العنوان"}),e.jsx("input",{value:s.title,onChange:a=>d({...s,title:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500 placeholder-gray-500":"bg-white border-gray-300 focus:border-blue-500"}`,placeholder:"أدخل عنوان المهمة",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"الوصف"}),e.jsx("textarea",{value:s.description,onChange:a=>d({...s,description:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500 placeholder-gray-500":"bg-white border-gray-300 focus:border-blue-500"}`,placeholder:"أدخل وصف المهمة (اختياري)",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"الأولوية"}),e.jsx("select",{value:s.priority,onChange:a=>d({...s,priority:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:E.filter(a=>a.value).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"الحالة"}),e.jsx("select",{value:s.status,onChange:a=>d({...s,status:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:T.filter(a=>a.value).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"تاريخ التنفيذ"}),e.jsx("input",{type:"date",value:s.scheduled_date,onChange:a=>d({...s,scheduled_date:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"تاريخ الاستحقاق"}),e.jsx("input",{type:"date",value:s.due_date,onChange:a=>d({...s,due_date:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"مصدر المهمة"}),e.jsxs("select",{value:s.source_type,onChange:a=>d({...s,source_type:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:[e.jsx("option",{value:"none",children:"مستقلة"}),e.jsx("option",{value:"project",children:"مشروع"}),e.jsx("option",{value:"course",children:"دورة"}),e.jsx("option",{value:"lesson",children:"درس"})]})]}),s.source_type==="project"&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"المشروع"}),e.jsxs("select",{value:s.project_id,onChange:a=>d({...s,project_id:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:[e.jsx("option",{value:"",children:"اختر مشروعاً"}),(x.projects||[]).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),(s.source_type==="course"||s.source_type==="lesson")&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-bold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"الدورة"}),e.jsxs("select",{value:s.course_id,onChange:a=>d({...s,course_id:a.target.value}),className:`w-full border-2 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 font-medium transition-all ${l?"bg-gray-900 border-gray-700 text-gray-200 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:[e.jsx("option",{value:"",children:"اختر دورة"}),(x.courses||[]).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),s.source_type==="lesson"&&s.course_id&&e.jsx("div",{children:e.jsx(P,{label:"الدرس",value:s.lesson_id,onChange:a=>d({...s,lesson_id:a}),options:(x.lessons||[]).map(a=>({value:a.id,label:a.name,name:a.name})),placeholder:"اختر درساً",searchPlaceholder:"ابحث عن درس...",emptyMessage:s.course_id?"لا توجد دروس متاحة":"يرجى اختيار الدورة أولاً",required:s.source_type==="lesson",disabled:!s.course_id})}),s.source_type==="lesson"&&!s.course_id&&e.jsx("div",{className:`p-4 rounded-lg border-2 ${l?"bg-gray-800/50 border-gray-700 text-gray-400":"bg-gray-50 border-gray-200 text-gray-500"}`,children:e.jsx("p",{className:"text-sm text-center",children:"يرجى اختيار الدورة أولاً لعرض الدروس المتاحة"})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:`px-5 py-2.5 border-2 rounded-lg font-bold transition-all ${l?"border-gray-700 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:c,className:"px-5 py-2.5 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white rounded-lg font-bold shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:c?"جاري الحفظ...":"حفظ"})]})]})})}const X=()=>{const{darkMode:r}=p();return e.jsx("div",{className:`rounded-2xl shadow-sm border p-8 transition-colors duration-300 ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-100"}`,children:e.jsxs("div",{className:"space-y-6 animate-pulse",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4",children:[1,2,3,4,5].map(t=>e.jsxs("div",{className:`rounded-xl p-4 border ${r?"bg-gray-900 border-gray-700":"bg-gray-50 border-gray-100"}`,children:[e.jsx("div",{className:`h-4 rounded w-20 mb-2 ${r?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-8 rounded w-12 ${r?"bg-gray-600":"bg-gray-300"}`})]},t))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(t=>e.jsxs("div",{className:`rounded-xl shadow-sm border-2 p-6 ${r?"bg-gray-900 border-gray-700":"bg-white border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:`h-5 rounded w-3/4 ${r?"bg-gray-600":"bg-gray-300"}`}),e.jsx("div",{className:`h-3 rounded w-1/2 ${r?"bg-gray-700":"bg-gray-200"}`})]}),e.jsx("div",{className:`w-6 h-6 rounded ${r?"bg-gray-700":"bg-gray-200"}`})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:`h-3 rounded w-full ${r?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-3 rounded w-5/6 ${r?"bg-gray-700":"bg-gray-200"}`})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("div",{className:`h-6 rounded-full w-20 ${r?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`h-6 rounded-full w-16 ${r?"bg-gray-700":"bg-gray-200"}`})]}),e.jsxs("div",{className:`flex items-center justify-between pt-4 border-t ${r?"border-gray-700":"border-gray-100"}`,children:[e.jsx("div",{className:`h-4 rounded w-24 ${r?"bg-gray-700":"bg-gray-200"}`}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg ${r?"bg-gray-700":"bg-gray-200"}`}),e.jsx("div",{className:`w-8 h-8 rounded-lg ${r?"bg-gray-700":"bg-gray-200"}`})]})]})]},t))})]})})};function ie(){const{darkMode:r}=p(),t=B(),s=Q({onSuccess:t.refresh}),{toast:d,show:o,dismiss:g}=D(),[c,x]=u.useState("grid"),[l,a]=u.useState([]),[b,f]=u.useState(null),i=async h=>{try{await v.complete(h.id),o("تم إنهاء المهمة","success"),t.refresh()}catch(y){console.error(y),o("تعذر إكمال المهمة","error")}},j=h=>{f(h)},N=()=>{f(null)},$=h=>{a(y=>y.includes(h)?y.filter(A=>A!==h):[...y,h])},_=()=>{l.length===t.tasks.length?a([]):a(t.tasks.map(h=>h.id))},n=async()=>{if(!(l.length===0||!window.confirm(`هل تريد إكمال ${l.length} مهمة؟`)))try{await Promise.all(l.map(y=>v.complete(y))),o(`تم إكمال ${l.length} مهمة بنجاح`,"success"),a([]),t.refresh()}catch(y){console.error(y),o("تعذر إكمال بعض المهام","error")}},m=async()=>{if(!(l.length===0||!window.confirm(`هل تريد حذف ${l.length} مهمة؟ هذا الإجراء لا يمكن التراجع عنه.`)))try{await Promise.all(l.map(y=>v.delete(y))),o(`تم حذف ${l.length} مهمة بنجاح`,"success"),a([]),t.refresh()}catch(y){console.error(y),o("تعذر حذف بعض المهام","error")}};return e.jsx("div",{className:`min-h-screen transition-colors duration-300 ${r?"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900":"bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30"}`,children:e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 py-6 space-y-6",children:[e.jsx(L,{toast:d,onClose:g}),e.jsx("div",{className:`rounded-2xl shadow-lg border-2 p-8 transition-colors duration-300 ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-100"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:`text-4xl font-black flex items-center gap-3 mb-2 ${r?"text-gray-100":"text-gray-900"}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-lg",children:e.jsx("i",{className:"fas fa-tasks text-white text-xl"})}),"المهام"]}),e.jsxs("p",{className:`text-sm ${r?"text-gray-400":"text-gray-600"}`,children:["تتبع جميع المهام وترتيبها حسب الأولوية -"," ",t.tasks.length," مهمة"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(F,{to:"/kanban",className:`px-4 py-2.5 border-2 rounded-lg shadow-sm hover:shadow transition-all flex items-center gap-2 text-sm font-medium ${r?"bg-gray-900 border-gray-700 hover:border-indigo-500 hover:bg-gray-700 text-gray-300":"bg-white border-gray-300 hover:border-indigo-300 hover:bg-indigo-50 text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-columns"}),e.jsx("span",{children:"عرض Kanban"})]}),e.jsxs("button",{type:"button",onClick:()=>x(c==="grid"?"list":"grid"),className:`px-4 py-2.5 border-2 rounded-lg shadow-sm hover:shadow transition-all flex items-center gap-2 text-sm font-medium ${r?"bg-gray-900 border-gray-700 hover:border-indigo-500 hover:bg-gray-700 text-gray-300":"bg-white border-gray-300 hover:border-indigo-300 hover:bg-indigo-50 text-gray-700"}`,children:[e.jsx("i",{className:`fas ${c==="grid"?"fa-list":"fa-th-large"}`}),e.jsx("span",{children:c==="grid"?"عرض القائمة":"عرض الشبكة"})]}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:n,className:"px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2 text-sm font-bold",children:[e.jsx("i",{className:"fas fa-check-double"}),e.jsxs("span",{children:["إكمال (",l.length,")"]})]}),e.jsxs("button",{type:"button",onClick:m,className:"px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2 text-sm font-bold",children:[e.jsx("i",{className:"fas fa-trash"}),e.jsxs("span",{children:["حذف (",l.length,")"]})]})]}),e.jsxs("button",{type:"button",onClick:s.openCreate,className:"px-5 py-2.5 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2 text-sm font-bold",children:[e.jsx("i",{className:"fas fa-plus"}),e.jsx("span",{children:"مهمة جديدة"})]})]})]})}),t.error&&e.jsxs("div",{className:`p-4 border-2 rounded-xl flex items-center gap-3 transition-colors duration-300 ${r?"bg-red-900/30 border-red-800 text-red-300":"bg-red-50 border-red-200 text-red-700"}`,children:[e.jsx("i",{className:"fas fa-exclamation-circle text-xl"}),e.jsx("span",{children:"تعذر تحميل المهام"}),e.jsx("button",{onClick:t.refresh,className:`mr-auto px-4 py-2 rounded-lg transition-all font-bold text-sm ${r?"bg-red-700 hover:bg-red-600 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:"إعادة المحاولة"})]}),e.jsx(G,{stats:t.stats}),e.jsx(U,{filters:t.filters,onChange:t.setFilter,onReset:t.resetFilters}),t.loading?e.jsx(X,{}):e.jsxs(e.Fragment,{children:[t.tasks.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4",children:[e.jsx("input",{type:"checkbox",checked:l.length===t.tasks.length,onChange:_,className:"w-5 h-5 rounded border-2 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:`text-sm font-bold ${r?"text-gray-300":"text-gray-700"}`,children:["تحديد الكل (",t.tasks.length," مهمة)"]})]}),e.jsx(J,{tasks:t.tasks,onEdit:s.openEdit,onComplete:i,onQuickView:j,selectedTasks:l,onToggleSelect:$,viewMode:c})]}),e.jsx(W,{isOpen:s.modalOpen,mode:s.mode,formState:s.formState,onChange:s.setFormState,onSubmit:s.submit,onClose:s.close,submitting:s.submitting,lookups:s.lookups}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:N,children:e.jsxs("div",{className:`rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transition-colors duration-300 ${r?"bg-gray-800":"bg-white"}`,onClick:h=>h.stopPropagation(),children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-br from-blue-600 to-indigo-600 text-white p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-black mb-2",children:b.title}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-lg text-xs font-bold bg-white/20",children:b.status}),e.jsx("span",{className:"px-3 py-1 rounded-lg text-xs font-bold bg-white/20",children:b.priority})]})]}),e.jsx("button",{onClick:N,className:"text-white/80 hover:text-white transition-colors",children:e.jsx("i",{className:"fas fa-times text-xl"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[b.description&&e.jsxs("div",{children:[e.jsxs("h3",{className:`text-sm font-bold mb-2 flex items-center gap-2 ${r?"text-gray-300":"text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-align-right text-blue-600"}),"الوصف"]}),e.jsx("p",{className:`p-4 rounded-lg leading-relaxed ${r?"bg-gray-900 text-gray-300":"bg-gray-50 text-gray-600"}`,children:b.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.scheduled_date&&e.jsxs("div",{className:`p-4 rounded-lg transition-colors duration-300 ${r?"bg-blue-900/30 border border-blue-800":"bg-blue-50"}`,children:[e.jsx("h3",{className:`text-sm font-bold mb-1 ${r?"text-blue-400":"text-blue-700"}`,children:"التاريخ المحدد"}),e.jsx("p",{className:r?"text-gray-300":"text-gray-700",children:b.scheduled_date})]}),b.project&&e.jsxs("div",{className:`p-4 rounded-lg transition-colors duration-300 ${r?"bg-purple-900/30 border border-purple-800":"bg-purple-50"}`,children:[e.jsx("h3",{className:`text-sm font-bold mb-1 ${r?"text-purple-400":"text-purple-700"}`,children:"المشروع"}),e.jsx("p",{className:r?"text-gray-300":"text-gray-700",children:b.project.name})]}),b.course&&e.jsxs("div",{className:`p-4 rounded-lg transition-colors duration-300 ${r?"bg-indigo-900/30 border border-indigo-800":"bg-indigo-50"}`,children:[e.jsx("h3",{className:`text-sm font-bold mb-1 ${r?"text-indigo-400":"text-indigo-700"}`,children:"الدورة"}),e.jsx("p",{className:r?"text-gray-300":"text-gray-700",children:b.course.name})]})]}),e.jsxs("div",{className:`flex gap-3 pt-4 border-t ${r?"border-gray-700":"border-gray-200"}`,children:[e.jsxs("button",{onClick:()=>{s.openEdit(b),N()},className:"flex-1 text-center px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-md hover:shadow-lg transition-all",children:[e.jsx("i",{className:"fas fa-edit ml-2"}),"تعديل المهمة"]}),b.status!=="completed"&&e.jsxs("button",{onClick:()=>{i(b),N()},className:"px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold shadow-md hover:shadow-lg transition-all",children:[e.jsx("i",{className:"fas fa-check ml-2"}),"إكمال"]})]})]})]})})]})})}export{ie as default};
